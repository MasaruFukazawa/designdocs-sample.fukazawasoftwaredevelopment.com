# ユースケース図作成ルール

## 基本ルール

1. **ファイル保存場所**: `source/usecase/` ディレクトリに保存
2. **テンプレート使用**: `source/usecase/diagram.rst` をベースに作成
3. **索引への追加**: `source/usecase.rst` にリンクを追加
4. **用語定義**: 新しい用語は `source/domain_model.rst` に定義を記述

## ユースケース作成のインプット

ユースケース（図・記述）を作成する際の主要なインプットは以下の通りです：

### 1. ユーザーストーリー（user_story）
- `source/user_story.rst` および `source/user_story/*.rst` に記載された要求
- 「[ アクター ] は [ 目的 ] を達成するために [ こんなこと ] がしたい」形式の要求事項
- ユースケースの基本コースや事前・事後条件の根拠となる

### 2. ドメインモデル（domain_model） 
- `source/domain_model.rst` に定義されたアクターと用語
- プロジェクト固有の概念や用語の定義
- ユースケースで使用するアクター名や専門用語の統一に使用
- **重要**: ユースケースで使用するアクター名・用語は必ずdomain_modelに登録されているものを使用する

### 3. GitHubのissue
- 具体的な機能要求や不具合報告
- ユーザーストーリーの詳細化や補完情報として活用

**推奨ワークフロー**（ユースケース図・ユースケース記述共通）:
1. GitHubのissueを確認
2. ユーザーストーリーを作成
3. 関連するユーザーストーリーを参照
4. ドメインモデルでアクターと用語を確認
5. ユースケース図・記述を作成

## テンプレート形式

```rst
ユースケース図
============================================

[ アクター名 ] が行えるユースケース
--------------------------------------------

.. mermaid::

   %%{init: {"theme": "default"}}%%
   graph TB
       %% アクター定義
       Actor["🔸<br/>[ アクター名 ]"]
       
       %% ユースケース定義
       UseCase1["[ ユースケース1 ]"]
       UseCase2["[ ユースケース2 ]"]
       
       %% アクターとユースケースの関係
       Actor -.-> UseCase1
       Actor -.-> UseCase2
```

## 作成手順

### 1. GitHubのissueからユースケース図を作成する場合

1. GitHubのissueを確認し、アクターとユースケースを特定
2. `source/usecase/diagram.rst` のテンプレートを使用
3. アクター毎にセクションを分けて図を作成
4. 新しい用語があれば `source/domain_model.rst` に追加
5. `source/usecase.rst` にリンクを追加

### 2. 新しいユースケース図ファイルを作成する場合

1. `source/usecase/` ディレクトリに新しい `.rst` ファイルを作成
2. テンプレート形式に従って作成
3. `source/usecase.rst` にリンクを追加

## アクターアイコン

- 👤 一般ユーザー（顧客、利用者）
- 👥 管理者、運営者
- 🖥️ システム、外部システム
- 🔸 その他のアクター

## Mermaid記法のポイント

- **アクター定義**: `ActorName["🔸<br/>表示名"]`
- **ユースケース定義**: `UseCaseName["ユースケース名"]`
- **関係性**: `Actor -.-> UseCase` （点線矢印）
- **依存関係**: `UseCase1 --> UseCase2` （実線矢印、必要に応じて）

## ファイル構造例

```
source/usecase/
├── diagram.rst          # メインのユースケース図
├── shopping_flow.rst    # ショッピングフロー図
└── admin_tasks.rst      # 管理者タスク図
```

## 注意事項

1. **アクター毎に分離**: 一つの図にすべてのアクターを入れず、アクター毎に分けて見やすくする
2. **簡潔な表現**: ユースケース名は動詞で始まり、簡潔に表現する
3. **日本語と英語**: 必要に応じて英語併記も可能
4. **一貫性**: 同じプロジェクト内では用語とスタイルを統一する
5. **更新**: issueやユーザーストーリーの変更に応じて図も更新する

---

# ユースケース記述作成ルール

## 基本ルール

1. **ファイル保存場所**: `source/usecase/` ディレクトリに保存
2. **テンプレート使用**: `source/usecase/template.rst` をコピーして使用
3. **ファイル命名規則**: `[ 機能名 ]_[ 動作 ].rst` （例: `shopping_cart_registration.rst`）
4. **索引への追加**: `source/usecase.rst` にリンクを追加
5. **用語定義**: 新しいアクターや用語は `source/domain_model.rst` に定義を追加

## テンプレート構造

```rst
[ ユースケース名 ]
==========================================

アクター
--------------------------------------------
**主アクター**: [ メインのアクター名 ]
**副アクター**: [ サポートするアクター名（複数可）]

事前条件
--------------------------------------------
- [ 条件1 ]
- [ 条件2 ]

事後条件
--------------------------------------------
**成功時**:
- [ 成功時の状態1 ]
- [ 成功時の状態2 ]

**失敗時**:
- [ 失敗時の状態 ]

基本コース
--------------------------------------------
1. [ アクター ] が [ アクション ] する
2. システムが [ 処理 ] する
...
8. ユースケース終了

代替コース
--------------------------------------------
**[ ステップ番号 ]a. [ 例外状況 ]の場合**:
[ ステップ番号 ]a1. [ 例外処理1 ]
[ ステップ番号 ]a2. [ 例外処理2 ]
[ ステップ番号 ]a3. ユースケース終了

シーケンス図
--------------------------------------------
.. mermaid::
   [ Mermaidシーケンス図 ]
```

## 作成手順

### 1. GitHubのissueからユースケース記述を作成する場合

1. **インプット情報の収集**:
   - GitHubのissueの内容を確認
   - 関連する `source/user_story.rst` のユーザーストーリーを参照
   - `source/domain_model.rst` でアクターと用語の定義を確認

2. **ユースケースの分析**:
   - 主アクター（誰が）
   - 目的（何のために）
   - 具体的な行動（何をしたい）

3. **ファイル作成**:
   - `source/usecase/template.rst` をコピーして新しいファイルを作成
   - ファイル名は `[ 機能名 ]_[ 動作 ].rst` 形式で命名

4. **記述作成**:
   - テンプレートの各セクションを具体的に記述
   - ユーザーストーリーとドメインモデルの情報を活用

5. **関連ファイル更新**:
   - 新しいアクターや用語を `source/domain_model.rst` に追加
   - `source/usecase.rst` にリンクを追加

### 2. 各セクションの記述ガイドライン

#### アクター
- **主アクター**: ユースケースを開始するアクター（必須）
- **副アクター**: システムや外部サービスなど、処理に関わるアクター

#### 事前条件
- ユースケース開始前に満たされている必要がある条件
- システムの状態、ユーザーの状態、データの状態など

#### 事後条件
- **成功時**: ユースケースが正常終了した場合の状態
- **失敗時**: ユースケースが異常終了した場合の状態

#### 基本コース
- 正常なシナリオでの処理手順
- ステップは動作の順序で番号付け
- 最後は「ユースケース終了」で締める

#### 代替コース
- エラーや例外的な状況での処理手順
- 基本コースのステップ番号 + a, b, c... で識別
- 各代替コースは独立して記述

#### シーケンス図
- MermaidのsequenceDiagramを使用
- アクター、UI、コントローラー、サービス、データベースなどの相互作用を表現

## ユースケース名の命名規則

- **動詞 + 目的語**の形式で命名
- 例: 「商品をカートに登録する」「ユーザー情報を更新する」「注文履歴を表示する」

## 代替コースのパターン

1. **入力エラー**: 不正な入力値による例外処理
2. **システムエラー**: サーバーエラーやネットワークエラー
3. **権限エラー**: アクセス権限不足による例外処理
4. **データ不整合**: 期待するデータが存在しない場合
5. **外部システムエラー**: 連携する外部システムの障害

## 品質チェックポイント

1. **完全性**: すべてのセクションが適切に記述されているか
2. **明確性**: 曖昧な表現がなく、具体的に記述されているか
3. **一貫性**: 用語やアクター名が統一されているか
4. **実装可能性**: 実際の開発で使用できるレベルの詳細度か
5. **保守性**: 要件変更時に修正しやすい構造になっているか

## 関連ファイル

- `source/usecase.rst` - ユースケース図・記述の索引
- `source/usecase/template.rst` - ユースケース記述テンプレート  
- `source/usecase/diagram.rst` - ユースケース図テンプレート
- `source/domain_model.rst` - プロジェクト用語定義
- `source/user_story.rst` - ユーザーストーリー
- `.cursor/user_story.md` - ユーザーストーリー作成ルール

## 用語・アクター名の統一ルール

- **アクター名**: `source/domain_model.rst` のアクターセクションに定義されている名称を使用
- **専門用語**: `source/domain_model.rst` の用語セクションに定義されている用語を使用  
- **新しいアクター・用語**: ユースケース作成前に必ず `source/domain_model.rst` に追加してから使用
- **表記揺れ防止**: 同じ概念に対して複数の表現を使わず、domain_modelの定義に統一
