# ユーザーストーリー作成ルール

このプロジェクトでユーザーストーリーを作成する際の標準ルールです。

## 基本ルール

### 1. ファイル保存場所
- ユーザーストーリーファイルは `docs/design/source/user_story/` ディレクトリに保存すること
- ファイル名は内容を表す分かりやすい名前にすること（例：`shopping_cart.rst`, `user_login.rst`）

### 2. テンプレートの使用
- 新しいユーザーストーリーを作成する際は、`docs/design/source/user_story/template.rst` をコピーして使用すること
- テンプレートの構造を維持し、全てのセクションを埋めること
- **Agile形式**を採用：「As a / I want / So that」+ 「Given-When-Then」の形式

### 3. インデックスファイルへの追加
- 作成したユーザーストーリーファイルは、`docs/design/source/user_story/index.rst` の `.. toctree::` セクションにリンクを追加すること
- ファイル名は拡張子（`.rst`）を除いて記載すること
- リンクの順序は機能の重要度や作成順などを考慮して整理すること
- `template.rst` は通常最後に配置すること

### 4. 用語・設計の統一
- ユーザーストーリーで新しく出てきた用語は、`docs/design/source/domain_model.rst` に用語とその説明を記述すること
- 専門用語、システム固有の概念、業務用語などは必ず定義を追加すること
- ドメインモデルの用語と一貫性を保つこと

### 5. Git運用
- 新しいユーザーストーリーファイル追加時は適切なコミットメッセージでコミット・プッシュすること
- ファイル追加とインデックス更新は同じコミットに含めること

## インプット情報

ユーザーストーリー作成時に参照すべき情報源：

### 主要なインプット
- **GitHubのissue**: 要求の詳細、背景、期待される結果
- **ドメインモデル**: 用語定義、クラス図、アクター
- **既存のユースケース**: 関連する業務フロー、システム操作

### 補助的なインプット
- **関連するユーザーストーリー**: 類似機能や前提となる機能
- **データベース設計**: 既存のテーブル構造やデータモデル

## 推奨ワークフロー

1. **GitHubのissue確認**
   - issue番号、タイトル、詳細内容を確認
   - 要求の背景と期待される結果を理解

2. **ユーザーストーリー作成**（← このステップ）
   - `docs/design/source/user_story/template.rst` をコピー
   - Agile形式でユーザーストーリーを記述
   - `docs/design/source/user_story.rst` の `toctree` に新ファイルを追加

3. **ドメインモデル作成**
   - ユーザーストーリーで新しく出てきた用語・アクターを `docs/design/source/domain_model.rst` に定義
   - 必要に応じてクラス図を作成・更新

4. **ユースケース作成**
   - ユーザーストーリーに基づいてユースケース図・記述を作成
   - システム操作の詳細を定義

5. **データベース設計**
   - 必要に応じてER図とテーブル設計を作成

6. **Git運用**
   - 適切なコミットメッセージで変更をコミット・プッシュ

## Agile形式のユーザーストーリー

### 基本構造
```
As a [アクター]
I want [具体的な機能・操作]
So that [価値・目的]
```

### 受け入れ条件（Given-When-Thenシナリオ）
```
シナリオ1: [成功パターン]
Given [前提条件]
When [アクション]
Then [期待される結果]

シナリオ2: [異常パターン1]
Given [前提条件]
When [アクション]
Then [期待される結果]

シナリオ3: [異常パターン2]
Given [前提条件]
When [アクション]
Then [期待される結果]
```

## ファイル構造例

```
docs/design/source/
├── user_story.rst                    # ユーザーストーリー一覧（インデックス）
├── domain_model.rst                  # 用語定義・ドメインモデル・クラス図
├── usecase.rst                      # ユースケース一覧
├── database.rst                     # データベース設計一覧
└── user_story/
    ├── template.rst                  # Agile形式テンプレートファイル
    ├── shopping_cart.rst            # ショッピングカート機能
    └── user_authentication.rst      # ユーザー認証機能
```

## テンプレート構造（最新版）

現在のテンプレートには以下のセクションが含まれています：

- **タイトル**: issue番号と要求内容を明記
- **概要**: GitHubのissueへの参照
- **ユーザーストーリー**: Agile形式（As a/I want/So that）のリスト
- **受け入れ条件**: 3つのGiven-When-Thenシナリオ
- **ビジネス価値**: 機能実現による価値と影響
- **制約・前提条件**: 技術的制約、業務制約、前提条件

## 品質チェック

### 作成時チェックポイント
- [ ] GitHubのissueと内容が一致している
- [ ] Agile形式（As a/I want/So that）で記述されている
- [ ] 受け入れ条件が具体的で測定可能
- [ ] ドメインモデルの用語と一貫性がある
- [ ] 3つのシナリオ（成功+異常パターン）が記述されている
- [ ] `docs/design/source/user_story/index.rst`にファイルリンクが追加されている

### レビューポイント
- [ ] ユーザーストーリーが価値ベースで記述されている
- [ ] 受け入れ条件が実装・テスト可能
- [ ] 制約・前提条件が明確
- [ ] 他の設計文書（ユースケース、ドメインモデル）との整合性
- [ ] ビジネス価値が明確に示されている

## 注意事項

- ユーザーストーリーは実際のプロダクト開発で使用できるレベルの詳細度を保つこと
- 受け入れ条件は実装者とテスターが理解しやすい具体的な内容にすること
- ビジネス価値を明確に示し、機能の優先度判断に役立てること
- 新しい用語や概念が出てきた場合は、必ずドメインモデルに定義を追加すること
- GitHubのissueと常に連携し、要求の変更があった場合は適宜更新すること
- Agile形式を守り、ユーザー視点での価値記述を心がけること

## user_story/index.rst 運用ルール

### 基本構成（必須維持）

```rst
ユーザーストーリー 一覧
============================================

.. toctree::
   :maxdepth: 1

   [ユーザーストーリーファイル名]
   template
```

### 新しいユーザーストーリーファイル追加時の手順

1. **「ユーザーストーリー 一覧」セクションに追加**
   - 新しいユーザーストーリーファイル（例: `shopping_cart.rst`）を作成した場合
   - `user_story/index.rst` の toctree に追加
   - ファイル名は拡張子（`.rst`）を除いて記載

2. **追加順序**
   - 機能の重要度順または作成日順に配置
   - `template` は常に最後に配置

3. **記載例**:
```rst
ユーザーストーリー 一覧
============================================

.. toctree::
   :maxdepth: 1

   member_registration
   shopping_cart
   user_authentication
   template
```

### セクション構成ルール

- **タイトル**: 「ユーザーストーリー 一覧」で固定
- **toctree設定**: `:maxdepth: 1` を使用
- **templateファイル**: 常に最後に配置

## 関連文書

- `docs/design/source/domain_model.rst`: 用語定義とクラス図
- `docs/design/source/usecase.rst`: ユースケース設計
- `docs/design/source/database.rst`: データベース設計
- `.cursor/database.md`: データベース設計ルール
- `.cursor/usecase.md`: ユースケース作成ルール 