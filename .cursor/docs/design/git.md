# Git運用ルール

## コミットメッセージ

### 基本ルール
- **言語**: 日本語で記述する
- **形式**: 簡潔で分かりやすい説明を心がける
- **文体**: 丁寧語（です・ます調）または敬語を使用

### コミットメッセージの構造

```
[概要] (50文字以内)

[詳細説明] (必要に応じて)
- 変更点1
- 変更点2
- 変更点3
```

### 例

#### 単一機能の追加
```
ユーザーストーリー機能を追加

- ユーザーストーリーテンプレートを作成
- 作成ルールを.cursor/user_story.mdに文書化
- 索引ページを追加
```

#### ドキュメント更新
```
ドメインモデルに新しい用語を追加

- ショッピングカート関連の用語を定義
- ECサイト顧客の説明を詳細化
```

#### 複数ファイルの関連変更
```
ユースケース機能とドキュメントを追加

- アクター別構造のユースケース図テンプレートを追加
- 標準形式に従ったユースケース記述テンプレートを追加
- 包括的なユースケース作成ルール (.cursor/usecase.md) を作成
- ワークフロー確立: issue -> user_story -> domain_model -> usecase
- ユースケース索引 (docs/design/source/usecase.rst) を追加
- domain_modelとの用語統一を確保
```

## ブランチ戦略

### 基本方針
- **メインブランチ**: `main`
- **作業ブランチ**: 機能単位で作成
- **命名規則**: `feature/[機能名]` または `fix/[修正内容]`

### ブランチ例
```
feature/user-story-template
feature/usecase-diagram
fix/domain-model-typo
```

## プッシュのタイミング

### 推奨タイミング
1. **機能完成時**: 一つの機能が完全に実装された時
2. **ドキュメント完成時**: 一連のドキュメント作成・更新が完了した時
3. **作業区切り時**: 論理的な作業単位が完了した時

### 作業前の確認
```bash
git status          # 変更状況確認
git add .           # 全変更をステージング
git commit -m "..." # 日本語でコミット
git push            # リモートにプッシュ
```

## ファイル管理

### コミット対象
- **含める**: ソースファイル、ドキュメント、設定ファイル
- **除外**: 一時ファイル、ビルド成果物、個人設定

### .gitignoreの管理
- 不要なファイルは適切に除外設定
- チーム開発で共有すべき設定は含める

## 文書変更時の特別ルール

### ユーザーストーリー関連
```
ユーザーストーリー「[タイトル]」を追加

- [具体的な変更内容]
- 関連するドメインモデルの更新
```

### ユースケース関連
```
ユースケース「[タイトル]」を追加

- ユースケース図/記述を作成
- 新しいアクター・用語をドメインモデルに追加
- 索引ページを更新
```

### ドメインモデル関連
```
ドメインモデルに[分野]の用語を追加

- [用語1]: [説明]
- [用語2]: [説明]
- [アクター]: [説明]
```

## トラブルシューティング

### よくある問題と対処法

#### リモートとの競合
```bash
git pull           # リモートの最新を取得
# 競合解決後
git add .
git commit -m "競合解決"
git push
```

#### 間違ったコミット
```bash
git reset --soft HEAD~1  # 最新コミットを取り消し（変更は保持）
# 修正後
git add .
git commit -m "正しいコミットメッセージ"
```

## 品質チェックポイント

### コミット前確認事項
1. **ファイル完整性**: 必要なファイルがすべて含まれているか
2. **メッセージ品質**: 変更内容が適切に説明されているか
3. **関連更新**: 索引ファイルやドメインモデルの更新が漏れていないか
4. **テンプレート準拠**: 各種テンプレートやルールに従っているか

### 推奨ワークフロー
1. 作業前に`git status`で状況確認
2. 作業完了後に全体を確認
3. 適切なコミットメッセージで記録
4. 定期的にプッシュして共有

## 関連ファイル

- `.cursor/user_story.md` - ユーザーストーリー作成ルール
- `.cursor/usecase.md` - ユースケース作成ルール
- `docs/design/source/domain_model.rst` - プロジェクト用語定義
- `.gitignore` - Git除外設定

## 追加・更新した内容

### 1. 新しいルールファイル作成
- **`.cursor/mail.md`**: メール定義書作成の詳細ルール
  - 基本ルール（ファイル保存場所、テンプレート使用等）
  - **ユースケース記述との連携ルール**（重要な追加）
  - 推奨ワークフロー
  - 記述ガイドライン
  - 品質チェック
  - ファイル命名規則
  - トラブルシューティング

### 2. 統一ワークフロー更新
- **`.cursor/workflow.md`**:
  - ステップ5として「メール定義書作成（必要に応じて）」を追加
  - ステップ6にデータベース設計を移動
  - ワークフロー図とテーブルを更新
  - ファイル構造とルール文書配置に`mail/`ディレクトリを追加
  - 品質チェックとGit運用にメール関連を追加

## 重要な新機能

### ユースケース記述との連携ルール
メール定義書を作成する際は、以下の連携が必須となります：

1. **メール定義書作成**：`docs/design/source/mail/[メール名].rst`
2. **インデックス更新**：`docs/design/source/mail/index.rst`にリンク追加
3. **ユースケース更新**：関連する`docs/design/source/usecase/[機能名].rst`の「メール一覧」セクションにリンク追加

これにより、ユースケースからメール定義書への**トレーサビリティ**が確保されます。

### 統一されたワークフロー
```
GitHubのissue確認 → ユーザーストーリー作成 → ドメインモデル作成 → 
ユースケース作成 → メール定義書作成（必要に応じて） → データベース設計（必要に応じて）
```

メール定義書が体系的な設計プロセスに組み込まれ、他の設計文書との整合性が保たれます。

これで、メール送信機能を含む開発において、必要なメール定義書が漏れなく作成され、適切に管理される仕組みが整いました。
