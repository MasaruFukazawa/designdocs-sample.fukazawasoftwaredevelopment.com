# 設計文書作成ルール

## 基本原則

### ルールはmdファイル、実装はrstファイル

このプロジェクトでは、設計文書の一貫性を保つため、以下の役割分担を厳格に適用しています：

- **`.cursor/docs/design/*.md`**: 設計作成のルール、ガイドライン、手順、チェックリスト
- **`docs/design/source/**/*.rst`**: 実際の設計ドキュメント（Sphinx形式）

この分離により、以下のメリットを実現しています：

1. **保守性**: ルール変更時の影響範囲が明確
2. **一貫性**: 統一された設計思想とプロセス
3. **可読性**: rstファイルはシンプルな構造に集中
4. **効率性**: テンプレートとガイドラインの再利用

## ディレクトリ対応表

| 設計領域 | ルールファイル | 実装ディレクトリ | 主な目的 |
|---------|---------------|-----------------|----------|
| ユーザーストーリー | `user_story.md` | `docs/design/source/user_story/` | Agile要求定義 |
| ユースケース | `usecase.md` | `docs/design/source/usecase/` | 機能仕様詳細 |
| ドメインモデル | `domain_model.md` | `docs/design/source/domain_model.rst` | 業務概念定義 |
| 画面設計 | `screen.md` | `docs/design/source/screen/` | UI/UX設計 |
| データベース | `database.md` | `docs/design/source/database/` | DB設計 |
| DDD設計 | `ddd.md` | `docs/design/source/ddd/` | アーキテクチャ設計 |
| メール設計 | `mail.md` | `docs/design/source/mail/` | 通知・コミュニケーション |

## ファイル種別の役割

### `.cursor/docs/design/*.md` ファイル

**主な内容**:
- ファイル作成・更新の手順
- テンプレート構造の説明
- 品質チェック項目
- 命名規則・ファイル構成ルール
- 他文書との連携方法
- index.rst運用ルール

**作成・更新タイミング**:
- 新しい設計パターンを導入する時
- 品質問題が発生した時
- プロセス改善を行う時

### `docs/design/source/**/*.rst` ファイル

**主な内容**:
- 実際の設計内容
- 図表・テーブル
- 相互参照リンク
- シンプルなナビゲーション構造

**作成・更新タイミング**:
- 新機能の設計時
- 要件変更・仕様変更時
- バグ修正・改善時

## 新規設計領域追加時の手順

新しい設計領域（例：API設計、セキュリティ設計）を追加する場合：

### 1. ルールファイル作成 (`.cursor/docs/design/[領域名].md`)

```markdown
# [領域名]作成ルール

## 基本ルール
### ファイル保存場所
### テンプレート使用
### 用語統一

## 作成手順
## テンプレート形式
## 注意事項
## チェックリスト

## [領域名]/index.rst 運用ルール
### 基本構成（必須維持）
### 新しいファイル追加時の手順
```

### 2. 実装ディレクトリ作成 (`docs/design/source/[領域名]/`)

```
docs/design/source/[領域名]/
├── index.rst        # ナビゲーション構造
├── template.rst     # テンプレートファイル
└── [個別ファイル].rst
```

### 3. このREADME.mdの更新

- ディレクトリ対応表に追加
- 必要に応じて基本原則の更新

## 品質確保のガイドライン

### 整合性チェック

1. **相互参照の整合性**: リンク先ファイルの存在確認
2. **用語の統一**: `domain_model.rst`で定義された用語の使用
3. **テンプレート準拠**: 各mdファイルで定義されたテンプレート構造の遵守
4. **index.rst更新**: 新ファイル作成時の必須作業

### レビューポイント

1. **mdファイル変更時**: 既存rstファイルへの影響確認
2. **rstファイル変更時**: 対応するmdファイルのルール準拠確認
3. **新規ファイル作成時**: 命名規則・ディレクトリ構成の確認

## 運用上の注意事項

### やってはいけないこと

1. **rstファイルにルール記述**: 設計ルールはmdファイルに集約
2. **mdファイルに実装内容**: 具体的な設計内容はrstファイルに記載
3. **テンプレートファイルの実装利用**: template.rstは雛形専用
4. **index.rst複雑化**: シンプルなtoctree構造のみ維持

### 推奨プラクティス

1. **段階的更新**: ルール変更時は影響範囲を確認してから適用
2. **定期的整合性確認**: リンク切れ・用語不整合の定期チェック
3. **テンプレート改善**: 実際の使用経験からテンプレートを継続改善
4. **文書化の徹底**: 新しいパターンは必ずルール化

## 既存ファイル一覧

### 設計ルールファイル (`.cursor/docs/design/*.md`)

- `database.md` - データベース設計ルール
- `ddd.md` - DDD設計ルール  
- `domain_model.md` - ドメインモデル作成ルール
- `git.md` - Git運用ルール
- `mail.md` - メール設計ルール
- `screen.md` - 画面遷移図作成ルール
- `usecase.md` - ユースケース作成ルール
- `user_story.md` - ユーザーストーリー作成ルール
- `workflow.md` - 全体ワークフロー

### 実装ファイル (`docs/design/source/**/*.rst`)

主要なindex.rstファイル：
- `database/index.rst` - データベース設計一覧
- `ddd/index.rst` - DDD設計一覧
- `mail/index.rst` - メール設計一覧
- `screen/index.rst` - 画面設計一覧
- `usecase/index.rst` - ユースケース一覧
- `user_story/index.rst` - ユーザーストーリー一覧

## 今後の拡張予定

将来的に追加を検討している設計領域：

- **API設計**: RESTful API仕様
- **セキュリティ設計**: 認証・認可・データ保護
- **パフォーマンス設計**: 性能要件・最適化
- **テスト設計**: テストケース・テスト戦略
- **デプロイ設計**: インフラ・CI/CD

各領域も同じ「ルールはmdファイル、実装はrstファイル」の原則に従って整備予定です。 